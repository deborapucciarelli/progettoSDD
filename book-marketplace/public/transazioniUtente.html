<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Le Mie Transazioni</title>
  <link rel="stylesheet" href="/css/navbar.css">
  <link rel="stylesheet" href="/css/transazioniUtente.css">
</head>
<body>

<div id="navbar"></div>
<script src="/js/loadNavbar.js"></script>

<h1>Le Mie Transazioni</h1>
<div class="tx-container" id="txContainer"></div>

<script type="module">
let wallet = localStorage.getItem("walletAddress");
if (!wallet) {
  alert("Connetti il wallet per vedere le transazioni!");
  window.location.href = "/home.html";
}

async function loadTransactions() {
  const res = await fetch(`/api/transactions?wallet=${wallet}`);
  if (!res.ok) return console.error("Errore recupero transazioni");
  const txs = await res.json();

  const container = document.getElementById("txContainer");
  container.innerHTML = "";

  txs.forEach(tx => {
    const role = tx.buyer_wallet_address.toLowerCase() === wallet.toLowerCase() ? "buyer" : "seller";
    const div = document.createElement("div");
    div.className = `tx-item ${role}`;
    div.innerHTML = `
      <p><strong>Libro:</strong> ${tx["Book-Title"]} (ISBN: ${tx.ISBN})</p>
      <p><strong>Ruolo:</strong> ${role}</p>
      <p><strong>Wallet Opposto:</strong> ${role === "buyer" ? tx.seller_wallet_address : tx.buyer_wallet_address}</p>
      <p><strong>Prezzo:</strong> ${tx.amount} ${tx.currency}</p>
      <p><strong>Data:</strong> ${new Date(tx.timestamp).toLocaleString()}</p>
      <p><strong>TxHash:</strong> ${tx.tx_hash}</p>
    `;
    container.appendChild(div);
  });
}

loadTransactions();
</script>

</body>
</html>
